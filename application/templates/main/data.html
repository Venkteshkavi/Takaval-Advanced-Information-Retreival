{% extends "/main/mainbase.html" %}
      {% block title %}
          Takaval
      {% endblock %}

      {% block head %}
        <link href="/static/assets/css/jquery.timepicker.css" rel="stylesheet">
        <link href="/static/assets/plugins/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="/static/assets/css/angular-timezone-selector.min.css" media="screen">
      {% endblock %}

      {% block content %}
      <div ng-app="data-app" ng-controller="data-controller" class="data-class">
          <section id="wrapper-section">
            <div id="stripes">
              <span></span>
              <span></span>
              <span></span>
              <span></span>
              <span></span>
            </div>
            <section id="india-home">
                <div class="l-container">
                    <h1>Events Extracted From Crawled Articles</h1>
                </div>
            </section>
          </section>
          <section id="products" class="page-section light-bg">
            <div class="container c-header" style="margin-top:0px;margin-bottom:30px;">
                <h2 class="text-title" style="">Filter</h2>
                <h2 class="text-title" style="display:inline-block;float:right;margin: 0px;margin-top: -50px;">Total Results : {a totalItems[0][0] a}</h2>
                <div class="card" style="width:200px;">
                    <div class="form-group">
                        <label for="ffdate" class="control-label">Date Range</label>
                        <input type="text" ng-model="ffdate" placeholder="Select From Date" id="ffdate" class="date form-control"/>
                    </div>
                </div>
                <div class="card" style="width:200px;margin-left:20px;">
                    <div class="form-group">
                        <label for="ftdate" class="control-label"></label>
                        <input type="text" ng-model="ftdate" placeholder="Select To Date" id="ftdate" class="date form-control"/>
                    </div>
                </div>
                <div class="card" style="width:150px;margin-left:20px;">
                    <div class="form-group">
                            <label for="fcountry" class="control-label">Country</label>
                            <select ng-init="fcountry='all'" id="fcountry" ng-model="fcountry" class="form-control">
                                <option selected="selected" value="all">All</option>
                                <option value="india">India</option>
                                <option value="indonesia">Indonesia</option>
                                <option value="thailand">Thailand</option>
                            </select>
                    </div>
                </div>
                <div class="card" style="width:150px;margin-left:20px;">
                    <div class="form-group">
                            <label for="ftopic" class="control-label">Topic</label>
                            <select ng-init="ftopic='all'" id="ftopic" ng-model="ftopic" class="form-control">
                                <option selected="selected" value="all">All</option>
                                <option value="Riots">Riot</option>
                                <option value="Protests">Protest</option>
                                <option value="Violence against civilians">Violence</option>
                            </select>
                    </div>
                </div>
                <div class="card" style="width:150px;margin-left:20px;">
                        <div class="form-group">
                                <label for="felect" class="control-label">Election</label>
                                <select ng-init="felection='all'" id="felect" ng-model="felection" class="form-control">
                                    <option selected="selected" value="all">Both</option>
                                    <option value="True">Related To Election</option>
                                    <option value="False">Not Related To Election</option>
                                </select>
                        </div>
                    </div>
                <div class="card" style="margin-left:20px;float:right;right:0px;margin-top:20px;">
                    <button class="btn-def" ng-click="filter(ffdate,ftdate,fcountry,ftopic, felection)">Filter</button>
                </div>
            </div>
            <div class="container-xl" ng-repeat="c in cdata track by $index" ng-if="c.sentiment=='True' && c.classified_topic != 'Others'">
              <div class="btn-links card-product card-reskill">
                <span class="product-type no-election" ng-if="c.election == 'False'">Unrelated to Election</span>
                <span class="product-type yes-election" ng-if="c.election == 'True'">Related to Election</span>
                <span class="product-type topic">Classified Topic : {a c.classified_topic a}</span>
                <h2 class="text-title">{a c.title a}</h2>
                <p class="text-description"><b style="color:#000;font-size:16px;">Summary: </b>{a c.summary a}</p>
                <table id="tech-companies-1" class="table  table-striped" style="margin-top:10px;">
                    <thead>
                        <tr>
                            <th data-priority="3">Source</th>
                            <th data-priority="1">Event Date</th>
                            <th data-priority="2">Published Date</th>
                            <th data-priority="2">Org 1</th>
                            <th data-priority="3">Org 2</th>
                            <th data-priority="2">Actor 1</th>
                            <th data-priority="3">Actor 2</th>
                            <th data-priority="2">Country</th>
                            <th data-priority="2">Admin 1</th>
                            <th data-priority="2">Admin 2</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>{a c.src a}</td>
                            <td>{a c.event_date a}</td>
                            <td>{a c.pubDate a}</td>
                            <td>{a c.org1 a}</td>
                            <td>{a c.org2 a}</td>
                            <td>{a c.actor1 a}</td>
                            <td>{a c.actor2 a}</td>
                            <td>{a c.country a}</td>
                            <td>{a c.admin1 a}</td>
                            <td>{a c.admin2 a}</td>
                        </tr>
                    </tbody>
                </table>
              </div>
            </div>
            <div class="container-xl" style="margin-top:40px;">
                <div class="row" style="width:100%;">
                    <div class="col-xs-12" style="text-align:center;">
                        <center>
                            <pagination ng-show="totalItems>0" class="pagination pagination-split m-t-0 m-b-0" page="currentPage" max-size="noOfPages" total-items="totalItems" items-per-page="entryLimit" previous-text="&lt;" next-text="&gt;"></pagination>
                        </center>
                    </div>
                </div>
            </div>
          </section>
          <section id="reachout" class="page-section">
            <div class="l-container">
                
            </div>
          </section>
        </div>
        {% endblock %}

        {% block script %}

        <script src="/static/angular/angular.min.js" type="text/javascript"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.2.1/angular-sanitize.js"></script>
        <script src="/static/assets/js/jquery.timepicker.min.js"></script>
        <script src="/static/assets/plugins/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
        <script type="text/javascript" src='/static/angular/angular-timezone-selector.min.js'></script>
        <script src="https://angular-ui.github.io/bootstrap/ui-bootstrap-tpls-0.10.0.js" type="text/javascript"></script>
        
        <script>

            var app = angular.module('data-app', ['ngSanitize','angular-timezone-selector', 'ui.bootstrap']);

            angular.module('data-app').config(['$interpolateProvider', function($interpolateProvider) {
                $interpolateProvider.startSymbol('{a');
                $interpolateProvider.endSymbol('a}');
            }]);


            angular.module('data-app').controller('data-controller', function ($scope,$http,$window,$timeout,$location) {

                $scope.country = 'all';
                $scope.topic = 'all';
                $scope.election = 'all';
                $scope.ffdate = '2018-12-31';
                $scope.ftdate = '2019-05-06';

                $('#ffdate').datepicker({
                    autoclose: true,
                    todayHighlight: true,
                    orientation: 'top',
                    format: "yyyy-mm-dd",
                    startDate: '-126d',
                    endDate: '+0d'
                })

                $('#ftdate').datepicker({
                    autoclose: true,
                    todayHighlight: true,
                    orientation: 'top',
                    format: "yyyy-mm-dd",
                    startDate: '-126d',
                    endDate: '+0d'
                })
                
                // pagination controls
                $scope.currentPage = 1;
                $scope.totalItems = 0;
                $scope.entryLimit = 10; // items per page
                $scope.noOfPages = 15;
                $scope.cdata = [];
                $scope.getCrawlIndexData = function(){
                    let skip = ($scope.currentPage - 1) * $scope.entryLimit;
                    $http.post("/get/all-data", {
                        startIndex: skip,
                        limit: $scope.entryLimit,
                        fromDate: $scope.ffdate,
                        toDate: $scope.ftdate,
                        country: $scope.country,
                        topic: $scope.topic,
                        election: $scope.election
                    }).
                    success(function(response)
                    {
                        console.log(response)
                        $scope.cdata = response.cdata;
                        $scope.totalItems = response.totalCount;
                    })
                    .error(function(response){
                        console.warn(response);
                    });
                }

                var initiailzing = true;
                // $watch to get next page data
                $scope.$watch('currentPage', function(newPage){
                    if (initiailzing) {
                        $timeout(function() { initiailzing = false; });
                    } else {
                        $scope.currentPage = newPage;
                        $scope.getCrawlIndexData();
                    }
                });

                $scope.filter = function(fromDate, toDate, country, topic, election){
                    $scope.country = country;
                    $scope.topic = topic;
                    $scope.election = election;
                    $scope.getCrawlIndexData();
                }

                $scope.getCrawlIndexData();

            })
        
        </script>


        {% endblock %}
